version: '3'
services:
  # Service 1: The Real Linux Terminal Backend
  linux-backend:
    build: .
    container_name: production_terminal
    restart: always
    privileged: true  # Required for some system level operations
    ports:
      - "7681:7681"
    volumes:
      # Mount the Docker Socket so 'docker' commands work inside the terminal
      - /var/run/docker.sock:/var/run/docker.sock
      # Optional: Persist the root directory so you don't lose files on restart
      - terminal_data:/root

  # Service 2: The Flask Web Application (UI)
  web-ui:
    build: ./app
    container_name: terminal_dashboard
    restart: always
    ports:
      - "80:5000"
    depends_on:
      - linux-backend
    environment:
      - FLASK_ENV=production

volumes:
  terminal_data:
