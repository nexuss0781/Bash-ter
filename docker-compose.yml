version: '3.8'

services:
  # 1. THE HEAVY LINUX BACKEND
  # This container holds the languages, compilers, and the TTYD server.
  backend:
    build: ./backend
    container_name: linux_terminal_backend
    restart: always
    privileged: true  # Grants permission to perform system-level tasks
    ports:
      - "7681:7681"   # Expose the WebSocket stream
    volumes:
      # Mount host Docker socket (allows running 'docker' inside the web terminal)
      - /var/run/docker.sock:/var/run/docker.sock
      # Optional: Persist root home directory
      - term_data:/root

  # 2. THE FLASK WEB UI
  # This container serves the HTML/CSS interface.
frontend:
    build: ./frontend
    container_name: linux_terminal_ui
    restart: always
    ports:
      - "80:5000"
    env_file:  # <--- Add this line
      - .env   # <--- Add this line
    depends_on:
      - backend

volumes:
  term_data:
